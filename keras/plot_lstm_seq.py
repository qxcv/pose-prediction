#!/usr/bin/env python3

"""Plot a sequence of pose generated by predict_lstm.py. Anim code taken from
http://eli.thegreenplace.net/2016/drawing-animated-gifs-with-matplotlib/"""

from plot_random_pose import plot_pose
import matplotlib.pyplot as plt
from matplotlib.animation import FuncAnimation
import numpy as np
import sys

class Updater:
    def __init__(self, data):
        minima = data.min(axis=0).min(axis=1)
        maxima = data.max(axis=0).max(axis=1)
        extra = 0.5 * np.max(abs(maxima - minima))
        maxima += extra
        minima -= extra

        self.minima = minima
        self.maxima = maxima
        self.data = data
        self.handles = None

    def __call__(self, i):
        self.handles = plot_pose(self.data[i], old_h=self.handles)

        plt.axis('equal')
        plt.xlim(self.minima[0], self.maxima[0])
        plt.ylim(self.minima[1], self.maxima[1])
        plt.gca().invert_yaxis()

        return self.handles

if __name__ == '__main__':
    fig, ax = plt.subplots()
    fig.set_tight_layout(True)

    data = np.load('lstm_scrapes.npy')
    chosen_s = np.random.randint(data.shape[0])
    seq = data[chosen_s]
    update = Updater(seq)

    anim = FuncAnimation(fig, update, frames=np.arange(0, len(seq)), interval=1000/50.0)
    if len(sys.argv) > 1:
        anim.save(sys.argv[1], dpi=80, writer='imagemagick')
    else:
        plt.show()
